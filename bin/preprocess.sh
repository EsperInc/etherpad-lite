#!/bin/bash
set -eu

m4 \
  "-DETHERPAD_DB_USER=${ETHERPAD_DB_USER}" \
  "-DETHERPAD_DB_HOST=${ETHERPAD_DB_HOST}" \
  "-DETHERPAD_DB_PASSWORD=${ETHERPAD_DB_PASSWORD}" \
  "-DETHERPAD_PASSWORD=${ETHERPAD_PASSWORD}" \
  "-DETHERPAD_PORT=${ETHERPAD_PORT}" \
  "-DETHERPAD_DB_NAME=${ETHERPAD_DB_NAME:-etherpad_lite}" \
  "-DETHERPAD_LOG_LEVEL=${ETHERPAD_LOG_LEVEL:-WARN}" \
  "-DKAFKA_BOOTSTRAP_HOSTS=${KAFKA_BOOTSTRAP_HOSTS}" \
  settings.json.m4 > settings.json

echo "${ETHERPAD_API_KEY}" > APIKEY.txt

bin/wait-for-it.sh "${ETHERPAD_DB_HOST}:3306"
exec "$@"
